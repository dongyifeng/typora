规则引擎流程优化

# 一、背景

目前帖子、评论通过规则引擎入审，接口耗时P99将近1.5s。按照我们目前的使用方式，随着规则越来越多，接口耗时越来越严重。

![](/Users/dongyifeng/dongyf/git/typora/images/sb/43b621e2-45bc-4c7c-a432-a7d284d6a8ad.png)



# 二、规则引擎流程

![](/Users/dongyifeng/dongyf/git/typora/images/sb/d2ae0d33-d7c4-43bd-8601-67ec0098c583.png)

# 三、规则流配置详情

以帖子入审规则流为例（具体可以看下面的文件）：

规则节点（策略集、特征集）：43个、策略：60个、特征：45个

目前已知服务主要耗时点在特征拉取上，按照目前的配置方式，平均1个规则节点对应1个特征，规则节点是串行执行的，对应的特征也都是串行执行，严重耗时

# 四、存在问题

部分老的特征输出code重复，导致特征并行执行之后无法区分

# 五、改动点

1、将一系列具有相关性的策略合并成一个策略集，提高特征执行的并发度，减少规则节点数量

2、将特征输出区分，并将策略对应配置调整

# 六、优缺点

优点：

1、提高机审效率，降低接口超时

2、降低流程配置复杂度，很多时候不需要再添加规则节点，只需要配置到策略集一级就可以

3、改动点少

缺点：

提高了系统资源消耗，可能部分特征拉取之后没有使用