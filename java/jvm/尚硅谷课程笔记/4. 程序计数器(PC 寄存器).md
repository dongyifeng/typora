---
typora-root-url: ../../../../typora
---

  

# PC Register 介绍

JVM 中的程序计数寄存器（Program Counter Register）也叫：PC 寄存器、程序计数器。

<font color=green>PC 寄存器用来存储指向下一条指令的地址，也是即将要执行的指令代码。</font>由执行引擎读取下一条指令。



PC 寄存器的特点

- 占用内存空间很小，几乎可以忽略不计，运行速度最快的存储区域。
- 线程私有，每个线程都有自己的 PC 寄存器，与生命周期与线程的生命周期保持一致。
- PC 寄存器会存储当前线程正在执行的 Java 方法的 JVM 指令地址，如果正在执行 native 方法时，PC 寄存器是未指定值（undefned）。因为执行 native 方法是调用 C/C++ 方法。
- PC 寄存器是程序控制流的指示器，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个PC 寄存器来完成。
- 字节码解释器工作时就是通过改变PC 寄存器的值来选取下一条需要执行的字节码指令。



下图中绿色框内是：指令地址（偏移地址）。PC 寄存器存储的就是指令地址。

下图中红色框内是：操作指令。

![](/images/java/screenshot-20221125-155200.png)

```java
    public static void main(String[] args) {
        int i = 10;
        int j = 20;
        int k = i + j;

        String str = "abc";
        System.out.printf(str);
    }
```



# 常见问题 

**问题一：使用 PC 寄存器存储字节码指令地址有什么用？或者：为什么使用 PC 寄存器记录当前线程的执行地址呢？**

答：因为 CPU 需要不停的切换各个线程，切换回来以后，需要知道接着从哪一条指令开始继续执行。

JVM 的字节码解释器需要通过改变 PC 寄存器的值来明确下一条应该执行什么样的字节码指令。



![](/images/java/screenshot-20221127-153253.png)





**问题二：PC 寄存器为什么被设定为线程私有？**

答：CPU 在不停切换任务时，为了能够准确记录各个线程在执行的当前字节码指令地址，最好的办法自然是为每一个线程都分配一个 PC 寄存器，各个线程之间独立计算，从而不会出现相互干扰。

