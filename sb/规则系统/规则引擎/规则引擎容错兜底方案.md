---
typora-root-url: ../../../../typora
---

[TOC]

为避免规则引擎因某些故障导致服务不可用导致无法进审或无法审核,增加容错或兜底机制,暂时的实现方案有如下两种,不适用特征和规则代码有问题时的情况

# 一、延迟中间件异步检查

帖子端发帖进入规则引擎后,会同步发送延时消息,会异步检查规则引擎的处理结果.交互模型如下

![](/images/sb/adac9e91-8ed2-4e4f-b6c8-1f14543370be.png)

1. 规则引擎增加消息检查组件,按类型支持不同类别内容的检测.
2. 基于RMQ(或本地队列+延迟队列)的延时队列,细分为延迟触发的队列5s ,10s,15s等,当消息推送超过1次时发送告警.
3. 外部接口将消息推入流接口,并由消息检查组件将消息推送入延时队列
4. 消息检查组件负责推送消息,重推消息,检测消息,



![](/images/sb/9c12e361-1788-417a-9008-a756b0c4c004.png)



# 二、定制异常流程

基于现有特征与动作定制一个硬编码的规则流.规则流可能存在不同类别的特征集,将这些特征集分类,从规则的策略中拆分提取出判断条件.如入审流程

![](/images/sb/036c0c88-47ee-478f-b4ba-714aa6786994.png)