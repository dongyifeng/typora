---
typora-root-url: ../../../../typora
---

[TOC]

# 一、修订记录

## 1、背景与现状

审核系统重构，后端搭建规则引擎流，支持新审核流程的运行，现完成后端系统搭建，需要前端提供配置工具页面。

## 2、需求要点&目标

与业务规则相互匹配，使用更灵活可配置的方式去配置审核规则并予以实施。

- **⚠️：**文档内容仅包含一期部分，UE图中包含后续功能，但一期需要实现的前端内容将标注在文档和交互图中，请仔细阅读！！！～～～
- 粉色为一期暂不实现的内容
- 绿色为暂不确定内容
- 蓝色为勿遗漏
- 红色为改动点

关联文档：[规则引擎流程](https://nmrnpjdx89.feishu.cn/wiki/wikcnaPbHxYmNRkZuRANMEQXYeq) 

# 二、需求描述

## 1、规则引擎内容

![](/images/sb/image2021-8-24_15-41-35.png)

- 规则：包含特征集和策略集，特征是属性，用于匹配命中不同特征的策略集，并根据不同策略匹配不同动作（处罚）。
- 规则流：由特征+策略即特征+条件+动作组成基本规则流，即通用规则流程。

## 2、流程

### 2.1 审核业务流

![](/images/sb/image2021-8-26_17-53-17.png)

### 2.2 规则引擎流

![](/images/sb/image2021-9-1_14-37-19.png)



## 3、配置平台搭建

### 3.1 平台架构

- 新增配置平台，登陆方式为姓名拼音缩写+雪球邮箱密码

- 导航树：

  -  5个一级菜单：【权限管理】【知识库管理】【流程引擎配置】【引擎运行记录】【操作日志】
  - 权限管理-二级子菜单：用户管理、角色管理、资源管理
    -  知识库管理-二级子菜单：特征管理、策略集管理、其他变量配置
    -  知识库管理-特征管理-三级子菜单：特征配置、特征集配置
    -  知识库管理-策略集管理-三级子菜单：策略配置、处罚动作配置、策略集配置
  - 流程引擎配置-二级子菜单：规则流配置
  - 引擎运行记录
  - 操作日志

  ![](/images/sb/1e5a3af0-6fa0-411a-96ba-592569ed1c4b.png)

![](/images/sb/46b4f830-f57e-460d-9233-23518edaed01.png)

![](/images/sb/36b7560a-7904-4827-a0ba-e4e76f76be11.png)





### 3.2 权限管理

权限管理菜单下都是基本的用户账号的创建、用户角色的创建和功能资源权限的分配，与目前审核系统的结构保持一致。

- 用户管理：创建用户，需要填写姓名、邮箱和手机号，真实填写，不再要求雪球id。

![](/images/sb/383d218d-6618-40cc-a1f7-03c8fd9048c1.png)

![](/images/sb/67d07606-627b-47f8-8b16-1b02a56dee19.png)

![](/images/sb/34ddfaef-0434-4820-ab98-4bf6e9b1f3cc.png)

![](/images/sb/7f2f1881-ff2a-42bb-8ecb-c7e4d3d1fbea.png)

![](/images/sb/fe8578c0-38e8-47a8-ad93-269f2b647aa8.png)



- 角色管理：创建角色，分配资源，资源内是各级所有菜单（包含子菜单都要列出）的权限列表，支持多选，从角色分配资源。

![](/images/sb/1c178162-e3bd-4ec4-95d7-010dd1204b9b.png)

![](/images/sb/adfe4b03-dcb2-4e7b-9a5c-4b7e57212022.png)

![](/images/sb/6bf8ffb3-c3a2-4038-829f-207f6782a8a3.png)

![](/images/sb/fa9cafc8-36bd-4dd5-8ed1-2775aea6be7e.png)





- 资源管理：只做展示即可，所有菜单列表。

![](/images/sb/02e76a38-6f50-464c-97f5-4f637812e8fe.png)



### 3.3 知识库管理

![](/images/sb/dd3e0291-c42c-4d76-9de0-8fe2118fba20.png)

![](/images/sb/ef4d170e-ffd9-471a-822a-9d6bce7f308f.png)



#### 3.3.1 特征管理

（一期对于特征都是后端写入，没有新增操作）

- 特征管理
  - 特征集配置页面（一期仅支持查询，不支持其他功能生效）：
    -  查询/搜索条件：支持特征集合id、特征名称查询，功能【查询】【重置】；
    -  特征集列表：表头包含【特征集版本】【特征集id】【特征集名称】【特征模式】【创建人】【创建时间】【更新时间】【选择特征】【操作】
    - 功能键：
      - 【新增】：点击新增特征集，弹窗展示，弹窗内容如图。- 一期不做弹窗
      - 【选择/查看特征】-点击【选择】后进入特征详情弹窗，可以按类型或者特征名称搜索到目标特征进行添加至该特征集中。点击【查看】弹出该特征集中包含的特征id及名称。-一期不支持选择，只支持查看
      - 【操作】：启停键及编辑键。启用和停用是特征集是否生效的开关。编辑点击后进入和特征集新增一样的弹窗，弹窗标题改为【编辑特征集】即可。-一期启停控制不生效

![](/images/sb/1b2f5cd3-e01d-4145-9aa1-6bba1178f69a.png)

![](/images/sb/a5a6eca0-335b-45ee-9f63-1915a57b143c.png)





-  特征配置页面：
  -  查询条件：支持特征id、特征名称查询，功能【查询】【重置】
  - 特征列表：表头包含【特征id】【特征名称】【特征所属类型】【特征类型】【特征描述】【创建人】【创建时间】【更新时间】【操作】
  - 功能键：【新增】【导入】【启用】【删除】-一期按钮不生效
    -  新增：点击新增后弹出新增特征的弹窗，弹窗内容如图。
    - 导入：可以按特征导入模版进行导入，文件格式再定，UE如图（可以二期做）
    - 启用：启停按钮，控制特征是否生效。
    - 删除：可以删除特征

![](/images/sb/2daa5542-6702-4c94-9904-a5936a94d3f9.png)





#### 3.3.2 策略集管理

- 策略配置
  -  策略配置页面：
    - 查询条件：策略id/名称入参，生效场景选择
    - 策略配置列表：表头包含【策略id】【策略名称】【策略内容】【生效场景】【动作优先级】【绑定动作名称】【创建人】【创建时间】【备注】【策略状态】
    - 功能：新增策略/条件、启停、上下线、编辑

一期新增和编辑功能可跳转页面，但新增不可提交，可支持**编辑**。启停和上下线不生效，新增条件功能不可用。

- 新增/编辑策略：分为三个模块的配置区，基础配置、绑定动作配置、策略内容配置；

（1）基础配置：

-  字段： 策略名称、生效场景、生效状态
  - 生效场景：枚举由后端传入（）
  - 生效状态：枚举由后端传入（）

（2）绑定动作配置：

-  动作选择：枚举由后端传入动作的枚举列表
- 支持填写优先级，并且可增加减少动作数量         

（3）策略内容配置：

- 特征、特征属性：枚举由后端提供，支持所有枚举列表展示，支持手动输入搜索sug展示；
  -  特征与特征属性需要联动查询，A特征下包含B和C属性，则选择A特征后，属性列表仅出现B和C
- 条件表达式：枚举由后端提供，二期将增加条件的编辑。
- 阈值：可输入，格式为数字，支持小数点和百分数。
- 函数关系：支持且或的连接关系，但仅支持顺序连接，一维计算。
- 策略详情：手动输入

​                      （4）提交、取消按钮

![](/images/sb/bda1f346-03b9-4fdf-901e-71cafaca8ec8.png)

![](/images/sb/33d1c12a-f263-4c92-8b79-1cc335b4fc8b.png)



改动点：

- 策略内容配置部分，各个配置单元可单独填选，例如可直接写表达式，不选择特征，也可都填选。但选择特征属性的时候必须选中特征后才能选择，只有特征属性是与特征对应绑定的。



- 策略集配置
  - 查询条件：id/名称
  - 新增策略集：一期不可点
  - 列表字段：策略集id、版本号、策略集名称、策略集code、执行模式、优先级、策略列表、创建人、创建时间、备注、操作
  - 功能：
    - 查看策略列表：弹窗展示，id和名称字段，后端提供接口查询
    - 操作：复制当前版本、编辑-一期按钮不生效

![](/images/sb/c87bb4f8-ea09-4946-8e01-691e1b54a7a3.png)





- 处罚动作管理-一期不展示



#### 3.3.3 其他变量配置-一期不做



### 3.4 流程引擎配置

![](/images/sb/0970768e-2e07-4869-8774-302e4ab4b81d.png)

![](/images/sb/63d083c8-a98d-4b57-9a34-c02333e50f4f.png)



#### 3.4.1 策略集实例列表

策略集实例是创建了策略集之后系统自动创建的，所以实例列表的作用是同步展示策略集的创建，并且控制多个策略集版本的启停和上下线。但是一期只开发列表，所有操作按钮不生效。

- 查询条件：实例id、实例code
- 列表字段：id、code、模式、状态、创建人、创建时间、备注、操作
  -  操作：启停、上下线功能、删除功能-一期按钮不生效

![](/images/sb/45e5a746-69dc-4eb6-b8e1-8bf3af3cbb39.png)



#### 3.4.2 规则列表-一期不做



#### 3.4.3 规则流列表

- 查询条件：规则流id、规则流名称
- 列表字段：规则流id、规则流code、包含特征集id、规则流名称、创建人、创建时间、操作
- 功能：
  -  特征集合查看：点击弹出特征集合列表，并且在列表中每个集合可点击【包含特征列表】**链接**到【特征配置】页的列表，列表仅展示该特征集包含的特征即可。
  - 查询特征列表：如上描述，可链接到特征配置页，带入查询条件，查询出跳转前点击的对应特征集的特征id。
  - 编辑、启用、复制、删除：按钮暂不生效



![](/images/sb/53831ac8-2fe6-4176-9728-dcd955a98c15.png)

![img](https://xueqiu.feishu.cn/space/api/box/stream/download/asynccode/?code=OTQzOWFmNGRlMDUwMDc1YWIwYzgyZDRlNGRmYTBiNTFfUWxiVDdUa2Y1WFhNM3BraDVQTFA3cU1JbUl0YXMwaHRfVG9rZW46Ym94Y25PeDlHRnZjZk1CUkVxUWtLQmNNOEpYXzE2NjkxNjEzMDc6MTY2OTE2NDkwN19WNA)



#### 3.4.4 实例接口列表（该页面所有功能均需要一期实现）

实例接口列表页包含两个接口及两个弹窗展示，分别是【接口列表】和【实例列表】，但是只有点击接口列表中的查看实例按钮才能展示对应接口的实例列表，否则实例列表默认不展示。（实例列表开新页面展示）

- 接口列表：

  - 列表字段：接口code、接口名称、模式、创建人、创建时间、操作
  - 操作功能：选择模式、查看实例
    - 选择模式：点击后出弹窗，下拉列表选择模式后确认提交，取消关闭
    - 查看实例：点击后下方展示该列接口对应的实例列表

- 实例列表（结合下方

  改动点

  ）

  - 列表字段：id、规则流id、分流比例、策略默认返回值、状态、操作
  - 操作功能：规则流id超链接、启用、上线、分流配置
    - 规则流id超链接：跳转到规则流列表，带入该实例行对应的规则流id，在规则流页面查询到对应规则流展示。
    - 启用：点击后该实例处于待上线状态
    - 上线：点击后该实例处于上线中状态，已成为线上实例流程
    - 分流配置：点击后弹出分流比例弹窗，可通过下拉列表配置百分比，确认即提交，取消关闭。

![](/images/sb/15c5b0e0-1241-4092-8075-e74642a1895b.png)



改动点：

- 改动需求：实例列表中，上线操作的维度上移一层，由单一实例上下线改为可支持多个实例共同上下线。 

![](/images/sb/8b89b3a6-5f24-4eba-b2f6-9b7f255b1ba3.png)

最终版本：

状态默认初始状态为创建中，点击待发布则状态变为待发布，同时按钮置灰，再点击发布，状态变为已发布，按钮置灰，待发布按钮恢复，勾选后提交，所有实例提交状态，完成上线。



![](/images/sb/08334c74-ba0b-4d99-a243-1839d4e6d053.png)

## 4、接口

具体以开发提供的接口文档为准

详见：[规则系统表结构与说明](https://nmrnpjdx89.feishu.cn/wiki/wikcnVPx2VuxKxShwv3UQBH3upE) 

- 所有页面的查询接口：特征集列表、特征列表（包含属性）、策略集列表、策略列表、动作列表、策略集实例列表、规则流列表、规则实例接口列表
- 主要接口入参出参注意，查询条件和查询的内容，需要联动查询的部分为：
  -  特征集+特征查询
  - 策略集+策略查询
  - 策略集实例+策略集+策略查询
  - 规则流+特征集+特征查询
- 枚举值
  - 生效场景
  - 处罚动作
  - 特征及特征属性
  - 条件表达式
  - 实例接口模式





# 三、附件列表



| **文件列表**                                               | **描述**                                | **上传人** | **上传时间** |
| ---------------------------------------------------------- | --------------------------------------- | ---------- | ------------ |
| UE图 暂时无法在文档外展示此内容 暂时无法在文档外展示此内容 | 一期需要做的页面菜单名称后方有（1）标志 | @吕胜男    | 2021-12-16   |



















# 