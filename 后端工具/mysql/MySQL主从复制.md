MySQL主从复制通过在主库上记录二进制日志，在从库上重放日志的方式实现的，MySQL 默认采用异步复制方式。在同一时间备库的数据可能与主库的不一致，并且无法保证主备之间的延迟 

三个步骤

1.  在主库上把数据更改记录到二进制日志上（按照事务的提交顺序）
2.  备库将主库的二进制日志复制到自己的中继日志中
3.  备库读取中继日志中的事件，将其重放发到备库数据之上

MySQL完成主从复制，需要三个线程的参与：一个在(Master)主节点上，另外两个在(Slave)从节点上

1、(Master)Binlog Dump线程：

当有从节点连接到主节点时，主节点就创建一个线程将该主节点的二进制日志内容发送到主动连接的从节点上。

为了读取主节点上即将被发送到从节点的每一个事件(Event)，binlog Dump线程会对该binlog添加一个锁，直到这个事件被读取到甚至发送到从节点上，这个锁才会被释放。

2、(Slave)I/O线程：

当一个"START SLAVE"语句在从节点上发出时，从节点创建一个I/O线程；用来连接到配置好的主节点上并请求其发送binlog中的更新记录。这个I/O线程读取从binlog Dump线程发送过来的更新信息，将其复制到中继日志内(Relay log)。

3、(Slave)SQL线程：

从节点创建一个Slave SQL线程去读取由Slave I/O创建的relay log中的内容，将读取到的事件在从节点上进行重现。

 Mysq主从复制的类型

1、基于语句的复制：

主服务器上面执行的语句在从服务器上面再执行一遍，在MySQL-3.23版本以后支持。

存在的问题：时间上可能不完全同步造成偏差，执行语句的用户也可能是不同一个用户。

2、基于行的复制：

把主服务器上面改编后的内容直接复制过去，而不关心到底改变该内容是由哪条语句引发的，在MySQL-5.0版本以后引入。

存在的问题：比如一个工资表中有一万个用户，我们把每个用户的工资+1000，那么基于行的复制则要复制一万行的内容，由此造成的开销比较大，而基于语句的复制仅仅一条语句就可以了。

3、混合类型的复制：

MySQL默认使用基于语句的复制，当基于语句的复制会引发问题的时候就会使用基于行的复制，MySQL会自动进行选择。

在MySQL主从复制架构中，读操作可以在所有的服务器上面进行，而写操作只能在主服务器上面进行。主从复制架构虽然给读操作提供了扩展，可如果写操作也比较多的话（多台从服务器还要从主服务器上面同步数据），单主模型的复制中主服务器势必会成为性能瓶颈。

   

MySQL复制拓扑（MySQL不支持一个备库有多个主库）

1、一主多备库

2、主主复制（两台服务器互为备用服务器）

​    2.1、主动模式（两个都可以写，产生很多问题：1、对同一记录进行修改；2、自增；）

​    2.2、被动模式 （一台服务器是只读的被动服务器）

3、拥有备库的主主

4、环形复制（非常脆弱，尽量避免）

5、主-分发主库-多备库（主将数据给分发主库，分发主库发给多个备库）

6、树形（和5差不多，多个分发主库）